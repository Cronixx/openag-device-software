{% extends 'base.html' %}

{% block javascript %}
<script>
  var wifiSel = document.getElementById("wifiList");
  wifiSel.addEventListener("change", configureWifi);

  // debugrob, get the rest of the "status" vars

  //--------------------------------------------------------------------------
  window.onload = function() {
    var wifis = document.getElementById("wifis").value;
    console.log("connect.html onload wifis=" + wifis);

  }

  //--------------------------------------------------------------------------
  function configureWifi() {
    console.log("current wifiSel=" + wifiSel.value);
  }

  //--------------------------------------------------------------------------
  function connectWifi() {
    console.log("debugrob, connect to wifi:"+wifiSel.value);
    // debugrob, do POST with selected wifi to API to connect.
  }

  //--------------------------------------------------------------------------
  // debugrob, example of GET that returns data
  function getWifi() {
    return new Promise(function (resolve, reject) {
      console.log("Calling /api/connect/wifis")
      $.ajax({
        url: "/api/connect/wifis/",
        type: "GET",
        data: {"csrfmiddlewaretoken": "{{ csrf_token }}"},
        dataType: "json",
        success: function(data) {;
          console.log("got wifi data: " + data['wifis'])
          var wifis = data;
          resolve(wifis);
        },
        error: function(data) {
          console.log("get wifi data failed");
          reject(data);
        }
      });
    })
  }

</script>
{% endblock %}

{% block content %}
<html>
<input type="hidden" id="wifis" name="variable" value="{{ wifis }}">
<input type="hidden" id="valid_internet_connection" name="variable"
       value="{{ valid_internet_connection }}">
<input type="hidden" id="is_wifi_bbb" name="variable"
       value="{{ is_wifi_bbb }}">
<body>
<div class="connect">
  <div class="card" id="inet-card">
    <b>Wifi or Ethernet</b>

    <select id="wifiList" class="selectpicker" style="width:200px">
      {% for wifi in wifis %}
      <option value={{wifi}}>{{wifi}}</option>
      {% endfor %}
    </select>
    <a class="badge badge-secondary" data-toggle="collapse"
      style="width:200px" href="" role="button" onclick="connectWifi();">
      Connect to Wifi</a>
    </br>

    <ul>
      <li><b>Status:</b> {{ status }}
      <li><b>valid_internet_connection:</b> {{ valid_internet_connection }}
      <li><b>is_wifi_bbb:</b> {{ is_wifi_bbb }}

      <li><b>debugrob: need to connect to internet?</b>
      <li>if not connected to wifi, use scripts to show list of wifis
      <li>prompt for AP password

      <li>if on eth, should already be connected
      <li>show IP address
      <li>show serveo link

      <li><b>debugrob: need to register with IoT?</b>
      <li>enable "register this device" button
      <li>show verification code
      <li>show device ID

      <li>Advanced... button to delete all connmanctl settings.
      <li>Advanced... button to deregister device.

      {% if error != None %}
      <li><b>Error:</b> {{ error }}
      {% endif %}
    </ul>
  </div>
  <div class="card" id="iot-card">
    <b>IoT Registration</b>
  </div>
  <div class="card" id="adv-card">
    <b>Danger Zone</b>
  </div>
</div>
</body>
</html>
{% endblock %}
